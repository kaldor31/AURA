# created: 2025/10/05 23:23:49
#last-modified: 2025/10/06 00:08:24
# by kaldor31

import re

# Список "мусорных" слов и фраз (в начале и внутри запроса)
FILLER_PATTERNS = [
    r"\b(слушай|эй|ну|вот|короче|ладно|вообще|а если|если)\b",
    r"\b(подскажи|расскажи|скажи|объясни|интересно|можешь|пожалуйста|подскажешь)\b",
    r"\b(хочу спросить|вопрос|скажи пожалуйста)\b",
]

def clean_query(text: str) -> str:
    """
    Очищает запрос от вводных и нерелевантных слов.
    Не использует NLP-модели, только регулярки.
    """
    if not text:
        return ""

    # Переводим в нижний регистр и убираем пробелы
    text = text.lower().strip()

    # Убираем приветствия, обращение к боту, "слушай", "подскажи" и т.п.
    for pattern in FILLER_PATTERNS:
        text = re.sub(pattern, "", text)

    # Удаляем повторы пробелов и запятые в начале
    text = re.sub(r"^[,.\s]+", "", text)
    text = re.sub(r"\s{2,}", " ", text)
    text = re.sub(r"[?!.]+$", "", text)
    text = text.strip()

    # Если пользователь написал совсем мало — возвращаем исходное
    if len(text.split()) < 2:
        return text

    return text